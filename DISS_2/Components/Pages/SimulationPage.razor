@page "/SimulationPage"
@rendermode InteractiveServer
@using DISS_2.BackEnd
@using DISS_2.BackEnd.Core
@using DISS_2.BackEnd.TicketSelling
@using DISS_2.Components.Basic
@implements IDelegate;

<h3>SimulationPage</h3>

<h4>Simulation Time: @_simTime</h4>
<h4>People waiting in queue: @_peopleInQueue</h4>
<h4>Window busy: @_windowIsBusy</h4>

<textarea class="form-control">
    @_eventCalendarString
</textarea>

<button class="btn btn-primary" @onclick="RunSimulation">Run Simulation</button>

<SpeedControlComp/>


@code {
    private string _eventCalendarString = "";
    private string _simTime = "";
    private bool _windowIsBusy;
    private int _peopleInQueue = 0;
    private TicketSimulation? _simulation;
    private TicketSellingSimState? _state;

    protected override void OnInitialized()
    {
        MainApp.Instance.Delegates.Add(this);
    }

    public void UpdateUI(SimState simState)
    {
        TicketSellingSimState state = (TicketSellingSimState)simState;

        _simTime = TimeHandler.ToReadableTime(state.CurrentSimTime);
        _eventCalendarString = state.Calendar.ToString();

        _windowIsBusy = state.IsBusy;
        _peopleInQueue = state.PeopleInQueue;
        InvokeAsync(StateHasChanged);
    }

    private async Task RunSimulation()
    {
        _state = new();
        _simulation = new(_state);
        await _simulation.Run();
    }
}